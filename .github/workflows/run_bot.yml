name: Run BTC Bot V88 Master

on:
  schedule:
    - cron: '*/15 * * * *'  # Chạy mỗi 15 phút một lần
  workflow_dispatch:        # Nút bấm chạy tay để kiểm tra

permissions:
  contents: write           # Cấp quyền ghi để Bot tự lưu lịch sử lệnh và báo cáo

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install ccxt pandas requests

      - name: Run Bot V88
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: python bot.py

      - name: Save History and Reports
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "actions@github.com"
          # Thêm tất cả các file dữ liệu vào danh sách chờ lưu
          git add active_trades.json daily_report.json monthly_data.json trading_history.csv || true
          # Lưu các thay đổi với ghi chú, [skip ci] để tránh chạy vòng lặp vô tận
          git commit -m "Update trade logs and reports [skip ci]" || true
          # Đẩy dữ liệu mới lên lại kho lưu trữ GitHub
          git push
